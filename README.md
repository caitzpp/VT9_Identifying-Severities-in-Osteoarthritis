# Identifying Severities in Osteoarthritis (OA)

## Overview
This repository contains the main pipeline for identifying severity levels in osteoarthritis (OA) using **unsupervised clustering**.

The approach combines:

- questionnaire-based symptomatic data  
- radiographic Anomaly Scores (AS) derived from X-ray images  

The pipeline applies dimensionality reduction and clustering methods and evaluates results using both **internal** and **external validation metrics** to determine the most meaningful cluster structures.

---

## Motivation

This project was developed as part of a **master’s thesis**.

Traditional OA severity grading methods — such as the **Kellgren–Lawrence (KL) score** — are known to involve a degree of subjectivity and inter-rater variability.  
The goal of this work is to explore whether **data-driven severity groupings** can be derived that rely less on subjective human grading and instead emerge from patterns in multimodal patient data.

---

## Pipeline Overview
[Pipeline diagram](docs/OA Clustering Pipeline.png)

The pipeline consists of multiple stages, including:
* Questionnaire Data Preparation
* Anomaly Score Generation
* Unsupervised Clustering
* Severity based Clustering Ordering
* Evaluation

---

## Installation
The environment is managed using **conda** to ensure reproducibility.

### Prerequisites

- Conda (Anaconda or Miniconda recommended)
- Python 3.10+

### Step 1: Clone the repository

```bash
git clone <repository-url>
cd <repository-name>
```

### Step 2: Create the conda environment

Create the environment from the provided environment.yml file:

```bash
conda env create -f environment.yml
```

This will install all required dependencies and create a new environment.

Activate the environment:
```bash
conda activate oa-severity
```

---

## Project Structure
```markdown
data/
    raw/
        Raw data files including questionnaire data and image data
        images_knee/           Knee X-ray images
    processed/
        Processed datasets generated by notebooks and scripts

evaluation/
    Scripts and files used for cluster evaluation

notebooks/
    0_data_overview/
        Initial exploratory analysis

    1_modality_specific/
        symptomatic/
            smote/
                Evaluation of different SMOTE algorithms

    2_modality_comb/
        02_pipeline_eval.ipynb
            Generates plots and figures used to evaluate clustering results

    3_results/
        wandb_eval.ipynb
            Evaluation of Weights & Biases runs and behavior of external MSE metric

        severity_score_using_embeddings.ipynb
            Determines cluster severity ordering based on Euclidean distance
            to a reference "healthy" cluster

        klscores_pseudolabels.ipynb
            Compares cluster assignments with KL scores

        expert_feedback_eval.ipynb
            Evaluates expert feedback collected via the OA web application

src/
    pipeline/
        Core UMAP + HDBSCAN pipeline logic

    radiographic/
        Clustering logic for radiographic-based features

    SMOTE/
        Visualization and experimentation with SMOTE techniques

    symptomatic/
        Clustering logic for questionnaire-based data

utils/
    Shared helper functions and utilities
```

## Components and Related Repositories
This project interacts with and builds upon several related repositories:

**SS-FewSOME_Disease_Severity_Knee_Osteoarthritis**
[Link](https://github.com/caitzpp/SS-FewSOME_Disease_Severity_Knee_Osteoarthritis)
Used for radiographic anomaly score generation.
Repository by niamhbelton - [Link](https://github.com/niamhbelton/SS-FewSOME_Disease_Severity_Knee_Osteoarthritis)
Original implementation repurposed and adapted for this project.

**UnsupervisedClustering_OA_Webapp**
[Link](https://github.com/caitzpp/UnsupervisedClustering_OA_Webapp)
Web application developed to visualize embeddings and collect expert feedback on cluster assignments.
